
## 1.1 Определяем диск

`lsblk --scsi` //Команда для просмотра SATA/USB дисков

Если так получилось, что ставить линух на NVMe 
`lsblk --nvme` //Команда для просмотра NVMe дисков
#### План разделов GPT для UEFI на SSD

| Раздел | Название | Формат | Размер         | Назначение         |
| ------ | -------- | ------ | -------------- | ------------------ |
| sda1   | efi      | FAT32  | 300 MiB        | Загрузочный раздел |
| sda2   | boot     | EXT4   | 1 GiB          | Ядро               |
| sda3   | swap     | SWAP   | по размеру ОЗУ | Раздел подкачки    |
| sda4   | root     | BTRFS  | ост. место     | Система            |

_при юзании `btfrs`, если не разделить `efi` и `boot` на разные разделы, не получится настроить `grub` для автоматической загрузки последнего удачного входа, будет загружаться всегда пункт меню по умолчанию,_ _а именно не будут работать эти параметры в файле `/etc/default/grub`:_

_`GRUB_DEFAULT=saved`_  
_`GRUB_SAVEDEFAULT=true`_
## 1.2 Разбивка диска 

1. Создаем разделы:
   
- _раздел EFI (300M)_  
    Last sector, ±sectors or ±size{K,M,G,T,P} (2048-500118158, default 500117503): `+300M`  

- _раздел BOOT (1G)_  
    Last sector, ±sectors or ±size{K,M,G,T,P} (616448-500118158, default 500117503): `+1G`  

- _раздел SWAP (8G) размер выбираем равным оперативной памяти_  
    Last sector, ±sectors or ±size{K,M,G,T,P} (2713600-500118158, default 500117503): `+16G`  

- _раздел ROOT (отдаем оставшееся место)_  
    Last sector, ±sectors or ±size{K,M,G,T,P} (19490816-500118158, default 500117503): ):`↵`  

2. Задаем типы разделов:

- _задаем тип EFI разделу_  
    Partition number (1-4, default 4): `1`  
    Partition type or alias (type L to list all): `1`  

- _задаем тип SWAP разделу_  
    Partition number (1-4, default 4): `3`  
    Partition type or alias (type L to list all): `19`  

- _остальные разделы не трогаем_

3.  Сохраняем таблицу

## 1.3 Форматируем разделы

- Форматируем efi
`mkfs.fat -F32 /dev/sda1`

- Форматируем boot
`mkfs.ext4 -L boot /dev/sda2`

- Форматируем и включаем swap
~~~ Arch 
mkswap -L swap /dev/sda3  
swapon /dev/sda3
~~~
  
- Форматируем root
`mkfs.btrfs -L arch /dev/sda4 -f`
## 1.4 Монтируем разделы

- Создаем тома и подтома 
~~~ Arch 
mount /dev/sda4 /mnt  
btrfs su cr /mnt/@ //корень  
btrfs su cr /mnt/@var  
btrfs su cr /mnt/@home  
btrfs su cr /mnt/@snapshots  
umount /mnt
~~~
  
- Монтируем разделы
~~~ Arch 
mount -o noatime,compress=lzo,space_cache=v2,ssd,subvol=@ /dev/sda4 /mnt  
mkdir -p /mnt/{home,boot,var,.snapshots}  
mount -o noatime,compress=lzo,space_cache=v2,ssd,subvol=@var /dev/sda4 /mnt/var  
mount -o noatime,compress=lzo,space_cache=v2,ssd,subvol=@home /dev/sda4 /mnt/home  
mount -o noatime,compress=lzo,space_cache=v2,ssd,subvol=@snapshots /dev/sda4 /mnt/.snapshots  
mount /dev/sda2 /mnt/boot  
mkdir /mnt/boot/efi  
mount /dev/sda1 /mnt/boot/efi
~~~
  
## 1.5 Установка системы

- Ставим систему
`pacstrap /mnt base base-devel linux linux-headers linux-firmware intel-ucode|amd-ucode nano`

- Генерируем fstab
`genfstab -pU /mnt >> /mnt/etc/fstab`

- Меняем корневой каталог на `/mnt`
`arch-chroot /mnt`

- Задаем пароль root
`passwd`

- Даем имя ПК
`nano /etc/hostname`

- Настраиваем временную зону
`ln -sf /usr/share/zoneinfo/Eupore/Moscow /etc/localtime`

- Открываем файл с локалями
`nano /etc/locale.gen`
- Раскомментируем в содержимом файла `locale.gen`
~~~ Arch 
ru_RU.UTF8 UTF8  
en_US.UTF8 UTF8
~~~

  - Создаем локали
`locale-gen`

- Настраиваем язык консоли, добавляем кириллицу
~~~ Arch 
nano /etc/vconsole.conf  
  
//в содержимом файла vconsole.conf:  
  
KEYMAP=ru  
FONT=cyr-sun16
~~~
  
  - Устанавливаем язык системы по умолчанию
~~~ Arch 
nano /etc/locale.conf  
  
//в содержимом файла locale.conf:  
LANG="ru_RU.UTF-8"
~~~
  
- Инициализируем пакетный менеджер pacman
`pacman-key --init`

- Загружаем ключи
`pacman-key --populate archlinux`

  - Настраиваем pacman
~~~ Arch 
nano /etc/pacman.conf  
  
Раскомментируем в содержимом файла pacman.conf  
[multilib]  
Include = /etc/pacman.d.mirrorlist
~~~
  
- Опционально можно включить следующие опции в секции # Misc options:
		- Color — цветная подсветка pacman;
		- ParallelDownloads` — количество параллельных загрузок, рекомендация не ниже 5;
		- ILoveCandy — можно добавить забавный прогрессбар загрузки пакетов в стиле игры Pacman;

- Обновляем, устанавливаем необходимое
~~~ Arch
pacman -Sy  
pacman -S bash-completion openssh arch-install-scripts networkmanager git wget htop neofetch xdg-user-dirs pacman-contrib ntfs-3g 
~~~
  
- _чтобы заработал `bash-completion` при использовании `TAB`, необходимо выйти из `chroot` (`Ctrl+D`) и войти снова `arch-chroot /mnt`_

- Создаем начальный загрузочный диск
~~~ Arch
mkinitcpio -p linux  
 nano /etc/sudoers  
  
//Раскомментируем в содержимом файла sudoers  
%wheel ALL=(ALL:ALL) ALL
~~~
  
- Создаем пользователя
`useradd -mg users -G wheel <<имя_пользователя>> `

- Задаем пароль пользователю (рекомендуется отличный от пароля root)
`passwd <<имя_пользователя>> `

- Добавляем в загрузку сетевой менеджер
`systemctl enable NetworkManager.service`

- Ставим загрузчик Grub 
~~~ Arch

pacman -S grub efibootmgr grub-btrfs os-prober  
grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=Arch  
grub-mkconfig -o /boot/grub/grub.cfg
~~~

- Накатываем DE